---
title: Domain Name Systems (DNS) Pentesting
desc: Default port is 53.
tags: [53, Dig, DNS, Domain, Network, Nmap, Nslookup, OSINT, PrivEsc, Privilege, Recon]
alts: [Privilege-Escalation-Linux, Recon]
render_with_liquid: false
---

## Enumeration

1. **Automation**

    Using **Nmap**.

    ```sh
    nmap --script dns-nsec-enum --script-args dns-nsec-enum.domains vulnerable.com -p 53 <target-ip>
    nmap --script dns-random-srcport -p 53 <target-ip>
    nmap --script dns-recursion -p 53 <target-ip>
    nmap --script dns-service-discovery -p 53 <target-ip>
    nmap --script dns-* -p 53 <target-ip>
    ```

2. **Subdomains**

    - **Ffuf**

        You need to specify the filter like “-fs”, "-fc" or the macher like "-ms", "-mc".

        ```sh
        ffuf -u http://example.com/ -H "Host: FUZZ.example.com" -w subdomains -fs 1234
        ```

    - **Wfuzz**

        You need to specify the filter like "--hl".

        ```sh
        wfuzz -u http://example.com -H "Host: FUZZ.example.com" -w subdomains.txt --hl 138
        ```

    - **[MassDNS](https://github.com/blechschmidt/massdns){:target="_blank"}{:rel="noopener"}** is a DNS stub resolver for subdomain enumeration.

        ```sh
        ./scripts/subbrute.py lists/names.txt example.com | ./bin/massdns -r lists/resolvers.txt -t A -o S > results.txt
        ```

    - **[Knock](https://github.com/guelfoweb/knock){:target="_blank"}{:rel="noopener"}** is a subdomain scanner.

        ```sh
        knockpy vulnerable.com

        # Using wordlist
        knockpy -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt vulnerable.com
        ```

    - **[getallurls (gau)](https://github.com/lc/gau){:target="_blank"}{:rel="noopener"}** fetches known URLs for any given domains.

        ```sh
        printf example.com | gau
        ```

<br />

## Investigation

1. **OSINT**

    - **[DNSdumpster](https://dnsdumpster.com/){:target="_blank"}{:rel="noopener"}**

2. **Find IP Address from the Domain**

    ```sh
    host example.com
    nslookup example.com
    ```

3. **DNS Records**

    - **Dig**

        ```sh
        dig example.com any +nocmd +noall +answer

        # DNS Zone Transfer
        dig example.com @<target-ip> axfr

        # Cloudflare
        dig example.com @1.1.1.1
        # Google
        dig example.com @8.8.8.8
        # Quad9
        dig example.com @9.9.9.9
        ```

    - **Nslookup**

        ```sh
        nslookup -type=a example.com
        nslookup -type=aaaa example.com
        nslookup -type=c example.com
        nslookup -type=mx example.com
        nslookup -type=ns example.com
        ```

<br />

## Resolve Domains and IP Addresses in /etc/hosts

1. **Open an Editor to edit /etc/hosts**

    ```sh
    sudo vim /etc/hosts
    ```

2. **Add Custom Domains**

    You can add custom domains.

    ```sh
    127.0.0.1  localhost

    # Add the custom domain
    10.0.0.1  vulnerable.com subdomain.vulnerable.com
    10.0.0.2  vulnerable2.com

    ...
    ```

3. **Restart the Hostnamed**

    After that, you need to restart the hostnamed to apply it.

    ```sh
    sudo systemctl restart systemd-hostnamed
    ```

<br />

## Resolve Nameservers in /etc/resolv.conf

1. **Open an Editor to edit /etc/resolv.conf**

    ```sh
    sudo vim /etc/resolv.conf
    ```

2. **Add Custom Nameservers**

    You can add custom nameservers.

    ```sh
    # Google nameservers
    nameserver 8.8.8.8
    nameserver 8.8.4.4

    # Google nameservers (IPv6)
    nameserver 2001:4860:4860::8888
    nameserver 2001:4860:4860::8844
    ```

3. **Restart the Resolved**

    After that, you need to restart the resolved to apply it.

    ```sh
    sudo systemctl restart systemd-resolved.service
    ```

<br />

## DNS Spoofing

Also known as DNS cache poisoning. It corrupts Domain Name System data is introduced into the DNS resolver's cache, causing the name server to return an incorrect result record, e.g. an IP address.  

<br />

## Flush the DNS Cache

Clear IP addresses or DNS records from caches.

```sh
sudo resolvectl flush-caches
# or
sudo systemd-resolve --flush-cache
```

Check DNS caches are actually flushed

```sh
sudo resolvectl statistics
# or
sudo systemd-resolve --statistics
```

<br />

## DNS Exfiltration

**[dns-exfil-infil](https://github.com/kleosdc/dns-exfil-infil){:target="_blank"}{:rel="noopener"}**

<br />

## DNS Infiltration

Coming soon...

<br />

## DNS Tunneling

**[Iodine](https://github.com/yarrick/iodine){:target="_blank"}{:rel="noopener"}**
